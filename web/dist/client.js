var _excluded=["__clientOnlyKeys"];function _objectWithoutProperties(source,excluded){if(null==source)return{};var target=_objectWithoutPropertiesLoose(source,excluded),key,i;if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++){key=sourceSymbolKeys[i];if(0<=excluded.indexOf(key))continue;if(!Object.prototype.propertyIsEnumerable.call(source,key))continue;target[key]=source[key]}}return target}function _objectWithoutPropertiesLoose(source,excluded){if(null==source)return{};var target={},sourceKeys=Object.keys(source),key,i;for(i=0;i<sourceKeys.length;i++){key=sourceKeys[i];if(0<=excluded.indexOf(key))continue;target[key]=source[key]}return target}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})}}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly){symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable})}keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1,source;i<arguments.length;i++){source=null!=arguments[i]?arguments[i]:{};if(i%2){ownKeys(Object(source),!0).forEach(function(key){_defineProperty(target,key,source[key])})}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0})}else{obj[key]=value}return obj}(function(){'use strict';function Vnode(tag,key,attrs,children,text,dom){return{tag:tag,key:key,attrs:attrs,children:children,text:text,dom:dom,domSize:void 0,state:void 0,events:void 0,instance:void 0}}Vnode.normalize=function(node){if(Array.isArray(node))return Vnode("[",void 0,void 0,Vnode.normalizeChildren(node),void 0,void 0);if(null==node||"boolean"==typeof node)return null;if("object"==typeof node)return node;return Vnode("#",void 0,void 0,node+"",void 0,void 0)};Vnode.normalizeChildren=function(input){var children=[];if(input.length){for(var isKeyed=null!=input[0]&&null!=input[0].key,i=1;i<input.length;i++){if((null!=input[i]&&null!=input[i].key)!==isKeyed){throw new TypeError(isKeyed&&(null!=input[i]||"boolean"==typeof input[i])?"In fragments, vnodes must either all have keys or none have keys. You may wish to consider using an explicit keyed empty fragment, m.fragment({key: ...}), instead of a hole.":"In fragments, vnodes must either all have keys or none have keys.")}}for(var i=0;i<input.length;i++){children[i]=Vnode.normalize(input[i])}}return children};function hyperscriptVnode(){var attrs=arguments[this],start=this+1,children;if(null==attrs){attrs={}}else if("object"!=typeof attrs||null!=attrs.tag||Array.isArray(attrs)){attrs={};start=this}if(arguments.length===start+1){children=arguments[start];if(!Array.isArray(children))children=[children]}else{children=[];while(start<arguments.length){children.push(arguments[start++])}}return Vnode("",attrs.key,attrs,children)}var selectorParser=/(?:(^|#|\.)([^#\.\[\]]+))|(\[(.+?)(?:\s*=\s*('|'|)((?:\\[''\]]|.)*?)\5)?\])/g,selectorCache={};function isEmpty(object){for(var key in object){if(object.hasOwnProperty(key))return!1}return!0}function compileSelector(selector){var match,tag="div",classes=[],attrs={};while(match=selectorParser.exec(selector)){var type=match[1],value=match[2];if(""===type&&""!==value)tag=value;else if("#"===type)attrs.id=value;else if("."===type)classes.push(value);else if("["===match[3][0]){var attrValue=match[6];if(attrValue)attrValue=attrValue.replace(/\\([''])/g,"$1").replace(/\\\\/g,"\\");if("class"===match[4])classes.push(attrValue);else attrs[match[4]]=""===attrValue?attrValue:attrValue||!0}}if(0<classes.length)attrs.className=classes.join(" ");return selectorCache[selector]={tag:tag,attrs:attrs}}function execSelector(state,vnode){var attrs=vnode.attrs,children=Vnode.normalizeChildren(vnode.children),hasClass=attrs.hasOwnProperty("class"),className=hasClass?attrs.class:attrs.className;vnode.tag=state.tag;vnode.attrs=null;vnode.children=void 0;if(!isEmpty(state.attrs)&&!isEmpty(attrs)){var newAttrs={};for(var key in attrs){if(attrs.hasOwnProperty(key))newAttrs[key]=attrs[key]}attrs=newAttrs}for(var key in state.attrs){if(state.attrs.hasOwnProperty(key)&&"className"!==key&&!attrs.hasOwnProperty(key)){attrs[key]=state.attrs[key]}}if(null!=className||null!=state.attrs.className)attrs.className=null!=className?null!=state.attrs.className?state.attrs.className+""+" "+(className+""):className:null!=state.attrs.className?state.attrs.className:null;if(hasClass)attrs.class=null;for(var key in attrs){if(attrs.hasOwnProperty(key)&&"key"!==key){vnode.attrs=attrs;break}}if(Array.isArray(children)&&1===children.length&&null!=children[0]&&"#"===children[0].tag){vnode.text=children[0].children}else{vnode.children=children}return vnode}function hyperscript(selector){if(null==selector||"string"!=typeof selector&&"function"!=typeof selector&&"function"!=typeof selector.view){throw Error("The selector must be either a string or a component.")}var vnode=hyperscriptVnode.apply(1,arguments);if("string"==typeof selector){vnode.children=Vnode.normalizeChildren(vnode.children);if("["!==selector)return execSelector(selectorCache[selector]||compileSelector(selector),vnode)}vnode.tag=selector;if(vnode.attrs.ctx){vnode.ctx=vnode.attrs.ctx}return vnode}function trust(html){if(null==html)html="";return Vnode("<",void 0,void 0,html,void 0,void 0)}function fragment(){var vnode=hyperscriptVnode.apply(0,arguments);vnode.tag="[";vnode.children=Vnode.normalizeChildren(vnode.children);return vnode}hyperscript.trust=trust;hyperscript.fragment=fragment;var hooks={postHooks:{},addPost:function addPost(hook,func){if(!this.postHooks[hook])this.postHooks[hook]=[];this.postHooks[hook].push(func)},hasPost:function hasPost(hook){return!!this.postHooks[hook]},callPost:function callPost(hook,ret,args){for(var func of this.postHooks[hook]){ret=func.call(args[0],ret,...args)}return ret}},$doc=window.document,currentRedraw,nameSpace={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"};function getNameSpace(vnode){return vnode.attrs&&vnode.attrs.xmlns||nameSpace[vnode.tag]}function checkState(vnode,original){if(vnode.state!==original)throw new Error("'vnode.state' must not be modified.")}function callHook(vnode){var original=vnode.state;try{var ret=this.apply(original,arguments);if(hooks.hasPost(this.name)){ret=hooks.callPost(this.name,ret,arguments)}return ret}finally{checkState(vnode,original)}}function activeElement(){try{return $doc.activeElement}catch(e){return null}}function createNodes(parent,vnodes,start,end,hooks,nextSibling,ns){for(var i=start,vnode;i<end;i++){vnode=vnodes[i];if(null!=vnode){createNode(parent,vnode,hooks,ns,nextSibling)}}}function createNode(parent,vnode,hooks,ns,nextSibling){var tag=vnode.tag;if("string"==typeof tag){vnode.state={};if(null!=vnode.attrs)initLifecycle(vnode.attrs,vnode,hooks);switch(tag){case"#":createText(parent,vnode,nextSibling);break;case"<":createHTML(parent,vnode,ns,nextSibling);break;case"[":createFragment(parent,vnode,hooks,ns,nextSibling);break;default:createElement(parent,vnode,hooks,ns,nextSibling);}}else createComponent(parent,vnode,hooks,ns,nextSibling)}function createText(parent,vnode,nextSibling){vnode.dom=$doc.createTextNode(vnode.children);insertNode(parent,vnode.dom,nextSibling)}var possibleParents={caption:"table",thead:"table",tbody:"table",tfoot:"table",tr:"tbody",th:"tr",td:"tr",colgroup:"table",col:"colgroup"};function createHTML(parent,vnode,ns,nextSibling){var match=vnode.children.match(/^\s*?<(\w+)/im)||[],temp=$doc.createElement(possibleParents[match[1]]||"div");if("http://www.w3.org/2000/svg"===ns){temp.innerHTML="<svg xmlns=\"http://www.w3.org/2000/svg\">"+vnode.children+"</svg>";temp=temp.firstChild}else{temp.innerHTML=vnode.children}vnode.dom=temp.firstChild;vnode.domSize=temp.childNodes.length;vnode.instance=[];var fragment=$doc.createDocumentFragment(),child;while(child=temp.firstChild){vnode.instance.push(child);fragment.appendChild(child)}insertNode(parent,fragment,nextSibling)}function createFragment(parent,vnode,hooks,ns,nextSibling){var fragment=$doc.createDocumentFragment();if(null!=vnode.children){var children=vnode.children;createNodes(fragment,children,0,children.length,hooks,null,ns)}vnode.dom=fragment.firstChild;vnode.domSize=fragment.childNodes.length;insertNode(parent,fragment,nextSibling)}function createElement(parent,vnode,hooks,ns,nextSibling){var tag=vnode.tag,attrs=vnode.attrs,is=attrs&&attrs.is;ns=getNameSpace(vnode)||ns;var element=ns?is?$doc.createElementNS(ns,tag,{is:is}):$doc.createElementNS(ns,tag):is?$doc.createElement(tag,{is:is}):$doc.createElement(tag);vnode.dom=element;if(null!=attrs){setAttrs(vnode,attrs,ns)}insertNode(parent,element,nextSibling);if(!maybeSetContentEditable(vnode)){if(null!=vnode.text){if(""!==vnode.text)element.textContent=vnode.text;else vnode.children=[Vnode("#",void 0,void 0,vnode.text,void 0,void 0)]}if(null!=vnode.children){var children=vnode.children;createNodes(element,children,0,children.length,hooks,null,ns);if("select"===vnode.tag&&null!=attrs)setLateSelectAttrs(vnode,attrs)}}}function initComponent(vnode,hooks){var sentinel;if("function"==typeof vnode.tag.view){vnode.state=Object.create(vnode.tag);sentinel=vnode.state.view;if(null!=sentinel.$$reentrantLock$$)return;sentinel.$$reentrantLock$$=!0}else{vnode.state=void 0;sentinel=vnode.tag;if(null!=sentinel.$$reentrantLock$$)return;sentinel.$$reentrantLock$$=!0;vnode.state=null!=vnode.tag.prototype&&"function"==typeof vnode.tag.prototype.view?new vnode.tag(vnode):vnode.tag(vnode)}initLifecycle(vnode.state,vnode,hooks);if(null!=vnode.attrs)initLifecycle(vnode.attrs,vnode,hooks);vnode.instance=Vnode.normalize(callHook.call(vnode.state.view,vnode));if(vnode.instance===vnode)throw Error("A view cannot return the vnode it received as argument");sentinel.$$reentrantLock$$=null}function createComponent(parent,vnode,hooks,ns,nextSibling){initComponent(vnode,hooks);if(null!=vnode.instance){createNode(parent,vnode.instance,hooks,ns,nextSibling);vnode.dom=vnode.instance.dom;vnode.domSize=null!=vnode.dom?vnode.instance.domSize:0}else{vnode.domSize=0}}function updateNodes(parent,old,vnodes,hooks,nextSibling,ns){if(old===vnodes||null==old&&null==vnodes)return;else if(null==old||0===old.length)createNodes(parent,vnodes,0,vnodes.length,hooks,nextSibling,ns);else if(null==vnodes||0===vnodes.length)removeNodes(parent,old,0,old.length);else{var isOldKeyed=null!=old[0]&&null!=old[0].key,isKeyed=null!=vnodes[0]&&null!=vnodes[0].key,start=0,oldStart=0;if(!isOldKeyed)while(oldStart<old.length&&null==old[oldStart]){oldStart++}if(!isKeyed)while(start<vnodes.length&&null==vnodes[start]){start++}if(isOldKeyed!==isKeyed){removeNodes(parent,old,oldStart,old.length);createNodes(parent,vnodes,start,vnodes.length,hooks,nextSibling,ns)}else if(!isKeyed){var commonLength=old.length<vnodes.length?old.length:vnodes.length;start=start<oldStart?start:oldStart;for(;start<commonLength;start++){o=old[start];v=vnodes[start];if(o===v||null==o&&null==v)continue;else if(null==o)createNode(parent,v,hooks,ns,getNextSibling(old,start+1,nextSibling));else if(null==v)removeNode(parent,o);else updateNode(parent,o,v,hooks,getNextSibling(old,start+1,nextSibling),ns)}if(old.length>commonLength)removeNodes(parent,old,start,old.length);if(vnodes.length>commonLength)createNodes(parent,vnodes,start,vnodes.length,hooks,nextSibling,ns)}else{var oldEnd=old.length-1,end=vnodes.length-1,map,o,v,oe,ve,topSibling;while(oldEnd>=oldStart&&end>=start){oe=old[oldEnd];ve=vnodes[end];if(oe.key!==ve.key)break;if(oe!==ve)updateNode(parent,oe,ve,hooks,nextSibling,ns);if(null!=ve.dom)nextSibling=ve.dom;oldEnd--,end--}while(oldEnd>=oldStart&&end>=start){o=old[oldStart];v=vnodes[start];if(o.key!==v.key)break;oldStart++,start++;if(o!==v)updateNode(parent,o,v,hooks,getNextSibling(old,oldStart,nextSibling),ns)}while(oldEnd>=oldStart&&end>=start){if(start===end)break;if(o.key!==ve.key||oe.key!==v.key)break;topSibling=getNextSibling(old,oldStart,nextSibling);moveNodes(parent,oe,topSibling);if(oe!==v)updateNode(parent,oe,v,hooks,topSibling,ns);if(++start<=--end)moveNodes(parent,o,nextSibling);if(o!==ve)updateNode(parent,o,ve,hooks,nextSibling,ns);if(null!=ve.dom)nextSibling=ve.dom;oldStart++;oldEnd--;oe=old[oldEnd];ve=vnodes[end];o=old[oldStart];v=vnodes[start]}while(oldEnd>=oldStart&&end>=start){if(oe.key!==ve.key)break;if(oe!==ve)updateNode(parent,oe,ve,hooks,nextSibling,ns);if(null!=ve.dom)nextSibling=ve.dom;oldEnd--,end--;oe=old[oldEnd];ve=vnodes[end]}if(start>end)removeNodes(parent,old,oldStart,oldEnd+1);else if(oldStart>oldEnd)createNodes(parent,vnodes,start,end+1,hooks,nextSibling,ns);else{var originalNextSibling=nextSibling,vnodesLength=end-start+1,oldIndices=Array(vnodesLength),li=0,i=0,pos=2147483647,matched=0,map,lisIndices;for(i=0;i<vnodesLength;i++){oldIndices[i]=-1}for(i=end;i>=start;i--){if(null==map)map=getKeyMap(old,oldStart,oldEnd+1);ve=vnodes[i];var oldIndex=map[ve.key];if(null!=oldIndex){pos=oldIndex<pos?oldIndex:-1;oldIndices[i-start]=oldIndex;oe=old[oldIndex];old[oldIndex]=null;if(oe!==ve)updateNode(parent,oe,ve,hooks,nextSibling,ns);if(null!=ve.dom)nextSibling=ve.dom;matched++}}nextSibling=originalNextSibling;if(matched!=oldEnd-oldStart+1)removeNodes(parent,old,oldStart,oldEnd+1);if(0==matched)createNodes(parent,vnodes,start,end+1,hooks,nextSibling,ns);else{if(-1===pos){lisIndices=makeLisIndices(oldIndices);li=lisIndices.length-1;for(i=end;i>=start;i--){v=vnodes[i];if(-1===oldIndices[i-start])createNode(parent,v,hooks,ns,nextSibling);else{if(lisIndices[li]===i-start)li--;else moveNodes(parent,v,nextSibling)}if(null!=v.dom)nextSibling=vnodes[i].dom}}else{for(i=end;i>=start;i--){v=vnodes[i];if(-1===oldIndices[i-start])createNode(parent,v,hooks,ns,nextSibling);if(null!=v.dom)nextSibling=vnodes[i].dom}}}}}}}function updateNode(parent,old,vnode,hooks,nextSibling,ns){var oldTag=old.tag,tag=vnode.tag;if(oldTag===tag){vnode.state=old.state;vnode.events=old.events;if(shouldNotUpdate(vnode,old))return;if("string"==typeof oldTag){if(null!=vnode.attrs){updateLifecycle(vnode.attrs,vnode,hooks)}switch(oldTag){case"#":updateText(old,vnode);break;case"<":updateHTML(parent,old,vnode,ns,nextSibling);break;case"[":updateFragment(parent,old,vnode,hooks,nextSibling,ns);break;default:updateElement(old,vnode,hooks,ns);}}else updateComponent(parent,old,vnode,hooks,nextSibling,ns)}else{removeNode(parent,old);createNode(parent,vnode,hooks,ns,nextSibling)}}function updateText(old,vnode){if(old.children.toString()!==vnode.children.toString()){old.dom.nodeValue=vnode.children}vnode.dom=old.dom}function updateHTML(parent,old,vnode,ns,nextSibling){if(old.children!==vnode.children){removeHTML(parent,old);createHTML(parent,vnode,ns,nextSibling)}else{vnode.dom=old.dom;vnode.domSize=old.domSize;vnode.instance=old.instance}}function updateFragment(parent,old,vnode,hooks,nextSibling,ns){updateNodes(parent,old.children,vnode.children,hooks,nextSibling,ns);var domSize=0,children=vnode.children;vnode.dom=null;if(null!=children){for(var i=0,child;i<children.length;i++){child=children[i];if(null!=child&&null!=child.dom){if(null==vnode.dom)vnode.dom=child.dom;domSize+=child.domSize||1}}if(1!==domSize)vnode.domSize=domSize}}function updateElement(old,vnode,hooks,ns){var element=vnode.dom=old.dom;ns=getNameSpace(vnode)||ns;if("textarea"===vnode.tag){if(null==vnode.attrs)vnode.attrs={};if(null!=vnode.text){vnode.attrs.value=vnode.text;vnode.text=void 0}}updateAttrs(vnode,old.attrs,vnode.attrs,ns);if(!maybeSetContentEditable(vnode)){if(null!=old.text&&null!=vnode.text&&""!==vnode.text){if(old.text.toString()!==vnode.text.toString())old.dom.firstChild.nodeValue=vnode.text}else{if(null!=old.text)old.children=[Vnode("#",void 0,void 0,old.text,void 0,old.dom.firstChild)];if(null!=vnode.text)vnode.children=[Vnode("#",void 0,void 0,vnode.text,void 0,void 0)];updateNodes(element,old.children,vnode.children,hooks,null,ns)}}}function updateComponent(parent,old,vnode,hooks,nextSibling,ns){vnode.instance=Vnode.normalize(callHook.call(vnode.state.view,vnode));if(vnode.instance===vnode)throw Error("A view cannot return the vnode it received as argument");updateLifecycle(vnode.state,vnode,hooks);if(null!=vnode.attrs)updateLifecycle(vnode.attrs,vnode,hooks);if(null!=vnode.instance){if(null==old.instance)createNode(parent,vnode.instance,hooks,ns,nextSibling);else updateNode(parent,old.instance,vnode.instance,hooks,nextSibling,ns);vnode.dom=vnode.instance.dom;vnode.domSize=vnode.instance.domSize}else if(null!=old.instance){removeNode(parent,old.instance);vnode.dom=void 0;vnode.domSize=0}else{vnode.dom=old.dom;vnode.domSize=old.domSize}}function getKeyMap(vnodes,start,end){var map=Object.create(null);for(;start<end;start++){var vnode=vnodes[start];if(null!=vnode){var key=vnode.key;if(null!=key)map[key]=start}}return map}var lisTemp=[];function makeLisIndices(a){for(var result=[0],u=0,v=0,i=0,il=lisTemp.length=a.length,i=0;i<il;i++){lisTemp[i]=a[i]}for(var i=0;i<il;++i){if(-1===a[i])continue;var j=result[result.length-1];if(a[j]<a[i]){lisTemp[i]=j;result.push(i);continue}u=0;v=result.length-1;while(u<v){var c=(u>>>1)+(v>>>1)+(1&(u&v));if(a[result[c]]<a[i]){u=c+1}else{v=c}}if(a[i]<a[result[u]]){if(0<u)lisTemp[i]=result[u-1];result[u]=i}}u=result.length;v=result[u-1];while(0<u--){result[u]=v;v=lisTemp[v]}lisTemp.length=0;return result}function getNextSibling(vnodes,i,nextSibling){for(;i<vnodes.length;i++){if(null!=vnodes[i]&&null!=vnodes[i].dom)return vnodes[i].dom}return nextSibling}function moveNodes(parent,vnode,nextSibling){var frag=$doc.createDocumentFragment();moveChildToFrag(parent,frag,vnode);insertNode(parent,frag,nextSibling)}function moveChildToFrag(parent,frag,vnode){while(null!=vnode.dom&&vnode.dom.parentNode===parent){if("string"!=typeof vnode.tag){vnode=vnode.instance;if(null!=vnode)continue}else if("<"===vnode.tag){for(var i=0;i<vnode.instance.length;i++){frag.appendChild(vnode.instance[i])}}else if("["!==vnode.tag){frag.appendChild(vnode.dom)}else if(1===vnode.children.length){vnode=vnode.children[0];if(null!=vnode)continue}else{for(var i=0,child;i<vnode.children.length;i++){child=vnode.children[i];if(null!=child)moveChildToFrag(parent,frag,child)}}break}}function insertNode(parent,dom,nextSibling){if(null!=nextSibling)parent.insertBefore(dom,nextSibling);else parent.appendChild(dom)}function maybeSetContentEditable(vnode){if(null==vnode.attrs||null==vnode.attrs.contenteditable&&null==vnode.attrs.contentEditable)return!1;var children=vnode.children;if(null!=children&&1===children.length&&"<"===children[0].tag){var content=children[0].children;if(vnode.dom.innerHTML!==content)vnode.dom.innerHTML=content}else if(null!=vnode.text||null!=children&&0!==children.length)throw new Error("Child node of a contenteditable must be trusted.");return!0}function removeNodes(parent,vnodes,start,end){for(var i=start,vnode;i<end;i++){vnode=vnodes[i];if(null!=vnode)removeNode(parent,vnode)}}function removeNode(parent,vnode){var mask=0,original=vnode.state,stateResult,attrsResult;if("string"!=typeof vnode.tag&&"function"==typeof vnode.state.onbeforeremove){var result=callHook.call(vnode.state.onbeforeremove,vnode);if(null!=result&&"function"==typeof result.then){mask=1;stateResult=result}}if(vnode.attrs&&"function"==typeof vnode.attrs.onbeforeremove){var result=callHook.call(vnode.attrs.onbeforeremove,vnode);if(null!=result&&"function"==typeof result.then){mask|=2;attrsResult=result}}checkState(vnode,original);if(!mask){onremove(vnode);removeChild(parent,vnode)}else{if(null!=stateResult){var next=function next(){if(1&mask){mask&=2;if(!mask)reallyRemove()}};stateResult.then(next,next)}if(null!=attrsResult){var next=function next(){if(2&mask){mask&=1;if(!mask)reallyRemove()}};attrsResult.then(next,next)}}function reallyRemove(){checkState(vnode,original);onremove(vnode);removeChild(parent,vnode)}}function removeHTML(parent,vnode){for(var i=0;i<vnode.instance.length;i++){parent.removeChild(vnode.instance[i])}}function removeChild(parent,vnode){while(null!=vnode.dom&&vnode.dom.parentNode===parent){if("string"!=typeof vnode.tag){vnode=vnode.instance;if(null!=vnode)continue}else if("<"===vnode.tag){removeHTML(parent,vnode)}else{if("["!==vnode.tag){parent.removeChild(vnode.dom);if(!Array.isArray(vnode.children))break}if(1===vnode.children.length){vnode=vnode.children[0];if(null!=vnode)continue}else{for(var i=0,child;i<vnode.children.length;i++){child=vnode.children[i];if(null!=child)removeChild(parent,child)}}}break}}function onremove(vnode){if("string"!=typeof vnode.tag&&"function"==typeof vnode.state.onremove)callHook.call(vnode.state.onremove,vnode);if(vnode.attrs&&"function"==typeof vnode.attrs.onremove)callHook.call(vnode.attrs.onremove,vnode);if("string"!=typeof vnode.tag){if(null!=vnode.instance)onremove(vnode.instance)}else{var children=vnode.children;if(Array.isArray(children)){for(var i=0,child;i<children.length;i++){child=children[i];if(null!=child)onremove(child)}}}}function setAttrs(vnode,attrs,ns){if("input"===vnode.tag&&null!=attrs.type)vnode.dom.setAttribute("type",attrs.type);var isFileInput=null!=attrs&&"input"===vnode.tag&&"file"===attrs.type;for(var key in attrs){setAttr(vnode,key,null,attrs[key],ns,isFileInput)}}function setAttr(vnode,key,old,value,ns,isFileInput){if("key"===key||"is"===key||null==value||isLifecycleMethod(key)||old===value&&!isFormAttribute(vnode,key)&&"object"!=typeof value||"type"===key&&"input"===vnode.tag)return;if("o"===key[0]&&"n"===key[1])return updateEvent(vnode,key,value);if("xlink:"===key.slice(0,6))vnode.dom.setAttributeNS("http://www.w3.org/1999/xlink",key.slice(6),value);else if("style"===key)updateStyle(vnode.dom,old,value);else if(hasPropertyKey(vnode,key,ns)){if("value"===key){if(("input"===vnode.tag||"textarea"===vnode.tag)&&vnode.dom.value===""+value&&(isFileInput||vnode.dom===activeElement()))return;if("select"===vnode.tag&&null!==old&&vnode.dom.value===""+value)return;if("option"===vnode.tag&&null!==old&&vnode.dom.value===""+value)return;if(isFileInput&&""!=""+value){console.error("`value` is read-only on file inputs!");return}}vnode.dom[key]=value}else{if("boolean"==typeof value){if(value)vnode.dom.setAttribute(key,"");else vnode.dom.removeAttribute(key)}else vnode.dom.setAttribute("className"===key?"class":key,value)}}function removeAttr(vnode,key,old,ns){if("key"===key||"is"===key||null==old||isLifecycleMethod(key))return;if("o"===key[0]&&"n"===key[1])updateEvent(vnode,key,void 0);else if("style"===key)updateStyle(vnode.dom,old,null);else if(hasPropertyKey(vnode,key,ns)&&"className"!==key&&!("value"===key&&("option"===vnode.tag||"select"===vnode.tag&&-1===vnode.dom.selectedIndex&&vnode.dom===activeElement()))&&!("input"===vnode.tag&&"type"===key)){vnode.dom[key]=null}else{var nsLastIndex=key.indexOf(":");if(-1!==nsLastIndex)key=key.slice(nsLastIndex+1);if(!1!==old)vnode.dom.removeAttribute("className"===key?"class":key)}}function setLateSelectAttrs(vnode,attrs){if("value"in attrs){if(null===attrs.value){if(-1!==vnode.dom.selectedIndex)vnode.dom.value=null}else{var normalized=""+attrs.value;if(vnode.dom.value!==normalized||-1===vnode.dom.selectedIndex){vnode.dom.value=normalized}}}if("selectedIndex"in attrs)setAttr(vnode,"selectedIndex",null,attrs.selectedIndex,void 0)}function updateAttrs(vnode,old,attrs,ns){if(null!=attrs){if("input"===vnode.tag&&null!=attrs.type)vnode.dom.setAttribute("type",attrs.type);var isFileInput="input"===vnode.tag&&"file"===attrs.type;for(var key in attrs){setAttr(vnode,key,old&&old[key],attrs[key],ns,isFileInput)}}var val;if(null!=old){for(var key in old){if(null!=(val=old[key])&&(null==attrs||null==attrs[key])){removeAttr(vnode,key,val,ns)}}}}function isFormAttribute(vnode,attr){return"value"===attr||"checked"===attr||"selectedIndex"===attr||"selected"===attr&&vnode.dom===activeElement()||"option"===vnode.tag&&vnode.dom.parentNode===$doc.activeElement}function isLifecycleMethod(attr){return"oninit"===attr||"oncreate"===attr||"onupdate"===attr||"onremove"===attr||"onbeforeremove"===attr||"onbeforeupdate"===attr}function hasPropertyKey(vnode,key,ns){return ns===void 0&&(-1<vnode.tag.indexOf("-")||null!=vnode.attrs&&vnode.attrs.is||"href"!==key&&"list"!==key&&"form"!==key&&"width"!==key&&"height"!==key)&&key in vnode.dom}var uppercaseRegex=/[A-Z]/g;function toLowerCase(capital){return"-"+capital.toLowerCase()}function normalizeKey(key){return"-"===key[0]&&"-"===key[1]?key:"cssFloat"===key?"float":key.replace(uppercaseRegex,toLowerCase)}function updateStyle(element,old,style){if(old===style);else if(null==style){element.style.cssText=""}else if("object"!=typeof style){element.style.cssText=style}else if(null==old||"object"!=typeof old){element.style.cssText="";for(var key in style){var value=style[key];if(null!=value)element.style.setProperty(normalizeKey(key),value+"")}}else{for(var key in style){var value=style[key];if(null!=value&&(value=value+"")!==old[key]+""){element.style.setProperty(normalizeKey(key),value)}}for(var key in old){if(null!=old[key]&&null==style[key]){element.style.removeProperty(normalizeKey(key))}}}}function EventDict(){this._=currentRedraw}EventDict.prototype=Object.create(null);EventDict.prototype.handleEvent=function(ev){var handler=this["on"+ev.type],result;if("function"==typeof handler)result=handler.call(ev.currentTarget,ev);else if("function"==typeof handler.handleEvent)handler.handleEvent(ev);if(this._&&!1!==ev.redraw)(0,this._)();if(!1===result){ev.preventDefault();ev.stopPropagation()}};function updateEvent(vnode,key,value){if(null!=vnode.events){vnode.events._=currentRedraw;if(vnode.events[key]===value)return;if(null!=value&&("function"==typeof value||"object"==typeof value)){if(null==vnode.events[key])vnode.dom.addEventListener(key.slice(2),vnode.events,!1);vnode.events[key]=value}else{if(null!=vnode.events[key])vnode.dom.removeEventListener(key.slice(2),vnode.events,!1);vnode.events[key]=void 0}}else if(null!=value&&("function"==typeof value||"object"==typeof value)){vnode.events=new EventDict;vnode.dom.addEventListener(key.slice(2),vnode.events,!1);vnode.events[key]=value}}function initLifecycle(source,vnode,hooks){if("function"==typeof source.oninit){var ret=callHook.call(source.oninit,vnode);if(ret instanceof Promise){ret.then(currentRedraw)}}if("function"==typeof source.oncreate)hooks.push(callHook.bind(source.oncreate,vnode))}function updateLifecycle(source,vnode,hooks){if("function"==typeof source.onupdate)hooks.push(callHook.bind(source.onupdate,vnode))}function shouldNotUpdate(vnode,old){do{if(null!=vnode.attrs&&"function"==typeof vnode.attrs.onbeforeupdate){var force=callHook.call(vnode.attrs.onbeforeupdate,vnode,old);if(force!==void 0&&!force)break}if("string"!=typeof vnode.tag&&"function"==typeof vnode.state.onbeforeupdate){var force=callHook.call(vnode.state.onbeforeupdate,vnode,old);if(force!==void 0&&!force)break}return!1}while(!1);vnode.dom=old.dom;vnode.domSize=old.domSize;vnode.instance=old.instance;vnode.attrs=old.attrs;vnode.children=old.children;vnode.text=old.text;return!0}var currentDOM;function render(dom,vnodes,redraw){if(!dom)throw new TypeError("DOM element being rendered to does not exist.");if(null!=currentDOM&&dom.contains(currentDOM)){throw new TypeError("Node is currently being rendered to and thus is locked.")}var prevRedraw=currentRedraw,prevDOM=currentDOM,hooks=[],active=activeElement(),namespace=dom.namespaceURI;currentDOM=dom;currentRedraw="function"==typeof redraw?redraw:void 0;try{if(null==dom.vnodes)dom.textContent="";vnodes=Vnode.normalizeChildren(Array.isArray(vnodes)?vnodes:[vnodes]);updateNodes(dom,dom.vnodes,vnodes,hooks,null,"http://www.w3.org/1999/xhtml"===namespace?void 0:namespace);dom.vnodes=vnodes;if(null!=active&&activeElement()!==active&&"function"==typeof active.focus)active.focus();for(var i=0;i<hooks.length;i++){hooks[i]()}}finally{currentRedraw=prevRedraw;currentDOM=prevDOM}}function makeMount(){var subscriptions=[],pending=!1,offset=-1;function sync(){for(offset=0;offset<subscriptions.length;offset+=2){try{render(subscriptions[offset],Vnode(subscriptions[offset+1]),redraw)}catch(e){console.error(e)}}offset=-1}function redraw(){if(!pending){pending=!0;requestAnimationFrame(()=>{pending=!1;sync()})}}redraw.sync=sync;function mount(root,component){if(null!=component&&null==component.view&&"function"!=typeof component){throw new TypeError("m.mount expects a component, not a vnode.")}var index=subscriptions.indexOf(root);if(0<=index){subscriptions.splice(index,2);if(index<=offset)offset-=2;render(root,[])}if(null!=component){subscriptions.push(root,component);render(root,Vnode(component),redraw)}}return{mount:mount,redraw:redraw}}var magic=/^(?:key|oninit|oncreate|onbeforeupdate|onupdate|onbeforeremove|onremove)$/;function censor(attrs,extras){var result={};if(null!=extras){for(var key in attrs){if(attrs.hasOwnProperty(key)&&!magic.test(key)&&0>extras.indexOf(key)){result[key]=attrs[key]}}}else{for(var key in attrs){if(attrs.hasOwnProperty(key)&&!magic.test(key)){result[key]=attrs[key]}}}return result}function build$1(object){if("[object Object]"!==Object.prototype.toString.call(object))return"";var args=[];for(var key in object){destructure(key,object[key])}return args.join("&");function destructure(key,value){if(Array.isArray(value)){for(var i=0;i<value.length;i++){destructure(key+"["+i+"]",value[i])}}else if("[object Object]"===Object.prototype.toString.call(value)){for(var i in value){destructure(key+"["+i+"]",value[i])}}else args.push(encodeURIComponent(key)+(null!=value&&""!==value?"="+encodeURIComponent(value):""))}}function parse$1(string){if(""===string||null==string)return{};if("?"===string.charAt(0))string=string.slice(1);for(var entries=string.split("&"),counters={},data={},i=0;i<entries.length;i++){var entry=entries[i].split("="),key=decodeURIComponent(entry[0]),value=2===entry.length?decodeURIComponent(entry[1]):"";if("true"===value)value=!0;else if("false"===value)value=!1;var levels=key.split(/\]\[?|\[/),cursor=data;if(-1<key.indexOf("["))levels.pop();for(var j=0;j<levels.length;j++){var level=levels[j],nextLevel=levels[j+1],isNumber=""==nextLevel||!isNaN(parseInt(nextLevel,10));if(""===level){var key=levels.slice(0,j).join();if(null==counters[key]){counters[key]=Array.isArray(cursor)?cursor.length:0}level=counters[key]++}else if("__proto__"===level)break;if(j==levels.length-1)cursor[level]=value;else{var desc=Object.getOwnPropertyDescriptor(cursor,level);if(null!=desc)desc=desc.value;if(null==desc)cursor[level]=desc=isNumber?[]:{};cursor=desc}}}return data}function build(template,params){if(/:([^\/\.-]+)(\.{3})?:/.test(template)){throw new SyntaxError("Template parameter names must be separated by either a '/', '-', or '.'.")}if(null==params)return template;var queryIndex=template.indexOf("?"),hashIndex=template.indexOf("#"),queryEnd=0>hashIndex?template.length:hashIndex,pathEnd=0>queryIndex?queryEnd:queryIndex,path=template.slice(0,pathEnd),query={};Object.assign(query,params);var resolved=path.replace(/:([^\/\.-]+)(\.{3})?/g,function(m,key,variadic){delete query[key];if(null==params[key])return m;return variadic?params[key]:encodeURIComponent(params[key]+"")}),newQueryIndex=resolved.indexOf("?"),newHashIndex=resolved.indexOf("#"),newQueryEnd=0>newHashIndex?resolved.length:newHashIndex,newPathEnd=0>newQueryIndex?newQueryEnd:newQueryIndex,result=resolved.slice(0,newPathEnd);if(0<=queryIndex)result+=template.slice(queryIndex,queryEnd);if(0<=newQueryIndex)result+=(0>queryIndex?"?":"&")+resolved.slice(newQueryIndex,newQueryEnd);var querystring=build$1(query);if(querystring)result+=(0>queryIndex&&0>newQueryIndex?"?":"&")+querystring;if(0<=hashIndex)result+=template.slice(hashIndex);if(0<=newHashIndex)result+=(0>hashIndex?"":"&")+resolved.slice(newHashIndex);return result}function compileTemplate(template){var templateData=parse(template),templateKeys=Object.keys(templateData.params),keys=[],regexp=new RegExp("^"+templateData.path.replace(/:([^\/.-]+)(\.{3}|\.(?!\.)|-)?|[\\^$*+.()|\[\]{}]/g,function(m,key,extra){if(null==key)return"\\"+m;keys.push({k:key,r:"..."===extra});if("..."===extra)return"(.*)";if("."===extra)return"([^/]+)\\.";return"([^/]+)"+(extra||"")})+"$");return function(data){for(var i=0;i<templateKeys.length;i++){if(templateData.params[templateKeys[i]]!==data.params[templateKeys[i]])return!1}if(!keys.length)return regexp.test(data.path);var values=regexp.exec(data.path);if(null==values)return!1;for(var i=0;i<keys.length;i++){data.params[keys[i].k]=keys[i].r?values[i+1]:decodeURIComponent(values[i+1])}return!0}}function parse(url){var queryIndex=url.indexOf("?"),hashIndex=url.indexOf("#"),queryEnd=0>hashIndex?url.length:hashIndex,pathEnd=0>queryIndex?queryEnd:queryIndex,path=url.slice(0,pathEnd).replace(/\/{2,}/g,"/");if(!path)path="/";else{if("/"!==path[0])path="/"+path;if(1<path.length&&"/"===path[path.length-1])path=path.slice(0,-1)}return{path:path,params:0>queryIndex?{}:parse$1(url.slice(queryIndex+1,queryEnd))}}var pathname=Object.freeze({__proto__:null,build:build,compileTemplate:compileTemplate,parse:parse}),sentinel={};function makeRoute(mountSpace){var callAsync=window.setTimeout,p=Promise.resolve(),scheduled=!1,ready=!1,state=0,compiled,fallbackRoute,currentResolver=sentinel,component,attrs,currentPath,_lastUpdate,RouterRoot={onbeforeupdate:function onbeforeupdate(){state=state?2:1;return!(!state||sentinel===currentResolver)},onremove:function onremove(){window.removeEventListener("popstate",fireAsync,!1);window.removeEventListener("hashchange",resolveRoute,!1)},view:function view(){if(!state||sentinel===currentResolver)return;var vnode=[Vnode(component,attrs.key,attrs)];if(currentResolver)vnode=currentResolver.render(vnode[0]);return vnode}},SKIP=route.SKIP={};function resolveRoute(){scheduled=!1;var prefix=window.location.hash;if("#"!==route.prefix[0]){prefix=window.location.search+prefix;if("?"!==route.prefix[0]){prefix=window.location.pathname+prefix;if("/"!==prefix[0])prefix="/"+prefix}}var path=prefix.concat().replace(/(?:%[a-f89][a-f0-9])+/gim,decodeURIComponent).slice(route.prefix.length),data=parse(path);Object.assign(data.params,window.history.state);function reject(e){console.error(e);setPath(fallbackRoute,null,{replace:!0})}loop(0);function loop(i){for(;i<compiled.length;i++){if(compiled[i].check(data)){var payload=compiled[i].component,matchedRoute=compiled[i].route,localComp=payload,update=_lastUpdate=function lastUpdate(comp){if(update!==_lastUpdate)return;if(comp===SKIP)return loop(i+1);component=null!=comp&&("function"==typeof comp.view||"function"==typeof comp)?comp:"div";attrs=data.params,currentPath=path,_lastUpdate=null;currentResolver=payload.render?payload:null;if(2===state)mountSpace.redraw();else{state=2;mountSpace.redraw.sync()}};if(payload.view||"function"==typeof payload){payload={};update(localComp)}else if(payload.onmatch){p.then(function(){return payload.onmatch(data.params,path,matchedRoute)}).then(update,path===fallbackRoute?null:reject)}else update("div");return}}if(path===fallbackRoute){throw new Error("Could not resolve default route "+fallbackRoute+".")}setPath(fallbackRoute,null,{replace:!0})}}function fireAsync(){if(!scheduled){scheduled=!0;callAsync(resolveRoute)}}function setPath(path,data,options){path=build(path,data);if(ready){fireAsync();var state=options?options.state:null,title=options?options.title:null;if(options&&options.replace)window.history.replaceState(state,title,route.prefix+path);else window.history.pushState(state,title,route.prefix+path)}else{window.location.href=route.prefix+path}}function route(root,defaultRoute,routes){if(!root)throw new TypeError("DOM element being rendered to does not exist.");compiled=Object.keys(routes).map(function(route){if("/"!==route[0])throw new SyntaxError("Routes must start with a '/'.");if(/:([^\/\.-]+)(\.{3})?:/.test(route)){throw new SyntaxError("Route parameter names must be separated with either '/', '.', or '-'.")}return{route:route,component:routes[route],check:compileTemplate(route)}});fallbackRoute=defaultRoute;if(null!=defaultRoute){var defaultData=parse(defaultRoute);if(!compiled.some(function(i){return i.check(defaultData)})){throw new ReferenceError("Default route doesn't match any known routes.")}}if("function"==typeof window.history.pushState){window.addEventListener("popstate",fireAsync,!1)}else if("#"===route.prefix[0]){window.addEventListener("hashchange",resolveRoute,!1)}ready=!0;mountSpace.mount(root,RouterRoot);resolveRoute()}route.set=function(path,data,options){if(null!=_lastUpdate){options=options||{};options.replace=!0}_lastUpdate=null;setPath(path,data,options)};route.get=function(){return currentPath};route.prefix="#!";route.Link={view:function view(vnode){var child=hyperscript(vnode.attrs.selector||"a",censor(vnode.attrs,["options","params","selector","onclick"]),vnode.children),options,onclick,href;if(child.attrs.disabled=!!child.attrs.disabled){child.attrs.href=null;child.attrs["aria-disabled"]="true"}else{options=vnode.attrs.options;onclick=vnode.attrs.onclick;href=build(child.attrs.href,vnode.attrs.params);child.attrs.href=route.prefix+href;child.attrs.onclick=function(e){var result;if("function"==typeof onclick){result=onclick.call(e.currentTarget,e)}else if(null==onclick||"object"!=typeof onclick);else if("function"==typeof onclick.handleEvent){onclick.handleEvent(e)}if(!1!==result&&!e.defaultPrevented&&(0===e.button||0===e.which||1===e.which)&&(!e.currentTarget.target||"_self"===e.currentTarget.target)&&!e.ctrlKey&&!e.metaKey&&!e.shiftKey&&!e.altKey){e.preventDefault();e.redraw=!1;route.set(href,null,options)}}}return child}};route.param=function(key){return attrs&&null!=key?attrs[key]:attrs};return route}var mountSpace=makeMount(),route=makeRoute(mountSpace);function m$1(){return hyperscript.apply(this,arguments)}m$1.m=hyperscript;m$1.trust=hyperscript.trust;m$1.fragment=hyperscript.fragment;m$1.render=render;m$1.mount=mountSpace.mount;m$1.redraw=mountSpace.redraw;m$1.route=route;m$1.vnode=Vnode;m$1.hooks=hooks;m$1.pathname=pathname;function c(selector,attrs){for(var _len=arguments.length,children=Array(2<_len?_len-2:0),_key=2;_key<_len;_key++){children[_key-2]=arguments[_key]}if(attrs&&attrs.classes){attrs.class=attrs.classes.filter(c=>c).join(" ");delete attrs.classes}if(1>=children.length){children=children[0]}if("a"===selector){if(attrs&&attrs.href&&"#"!==attrs.href.charAt(0)){selector=m$1.route.Link}}else if("frag"===selector){selector="["}return m$1(selector,attrs,children)}Object.assign(c,m$1);c.hooks.addPost("view",(ret,node)=>{if(node.ctx){var stack=[ret];while(0<stack.length){var v=stack.pop();if(!v||"object"!=typeof v)continue;v.ctx=node.ctx;if(node.ctx&&node.ctx.t){if("string"==typeof v.text&&"@"===v.text.charAt(0)){v.text=node.ctx.t(v.text.slice(1))}else if("#"===v.tag&&"string"==typeof v.children&&"@"===v.children.charAt(0)){v.children=node.ctx.t(v.children.slice(1))}}if(v.children&&"object"==typeof v.children){if(Array.isArray(v.children))stack.push(...v.children);else stack.push(v.children)}}}return ret});function EventEmitter(){this.listeners=[];this.dispatched=[]}EventEmitter.prototype.on=function(type,callback){var listener={type:type,callback:callback};this.listeners.push(listener)};EventEmitter.prototype.once=function(type,callback){var listener={type:type,callback:callback,once:!0};this.listeners.push(listener)};EventEmitter.prototype.when=function(type,callback,keep){if(-1!=this.dispatched.indexOf(type)){callback();if(!keep)return}var listener={type:type,callback:callback,once:!keep,when:!0};this.listeners.push(listener)};EventEmitter.prototype.off=function(type,callback){for(var i in this.listeners){if(this.listeners[i].type==type){if(!callback||this.listeners[i].callback==callback)this.listeners.splice(i,1)}}};EventEmitter.prototype.emit=function(type,data){if(-1==this.dispatched.indexOf(type))this.dispatched.push(type);for(var i=0;i<this.listeners.length;i++){if(0>i)continue;if(this.listeners[i].type==type){this.listeners[i].callback.apply(null,Array.prototype.slice.call(arguments,1));if(this.listeners[i]&&this.listeners[i].once){this.listeners.splice(i,1);i--}}}};class ModelRegistry{constructor(ctx,routes){this.ctx=ctx;this.cache={};this.routes=routes.map(_ref=>{var{route,model}=_ref;return{route,model,check:c.pathname.compileTemplate(route)}})}get(p){var _this=this,_loop=function _loop(_route){var{path,params}=c.pathname.parse(p);if(_route.check({path,params})){return{v:()=>Object.assign(new _route.model(_this.ctx),_objectSpread({ctx:_this.ctx,api:_this.ctx.api.extend({base:path})},params))}}};for(var _route of this.routes){var _ret=_loop(_route);if("object"==typeof _ret)return _ret.v}return null}new(route,params){var path=c.pathname.build(route,params),ctor=this.get(path);if(!ctor)throw new Error("no model exists at path \"".concat(route,"\""));return ctor()}persistent(route,params){var path=c.pathname.build(route,params);if(this.cache[path])return this.cache[path];var model=this.new(route,params);this.cache[path]=model;return model}instanceof(instance,id){for(var _route2 of this.routes){var{path,params}=c.pathname.parse(c.pathname.build(id,{}));if(_route2.check({path,params})){return instance instanceof _route2.model}}return!1}}class BaseModel extends EventEmitter{assign(data){var _this2=this,overrides={};if(this.assignMappers){var _loop2=function _loop2(key){for(var{mapper}of _this2.assignMappers.filter(m=>m.key===key)){overrides[key]=mapper(overrides[key]||data[key])}};for(var key of Object.keys(data)){_loop2(key)}}Object.assign(this,data,overrides);return this}assignMap(key,mapper){if(!this.assignMappers){this.assignMappers=[]}if("string"==typeof mapper){var _route3=mapper,arrayBased="["===_route3.charAt(0)&&"]"===_route3.charAt(_route3.length-1);if(arrayBased)_route3=_route3.slice(1,-1);mapper=input=>{if(this.ctx.models.instanceof(input,_route3))return input;return this.ctx.models.new(_route3,input).assign(input)};if(arrayBased){var singleMapper=mapper;mapper=input=>Array.isArray(input)?input.map(i=>singleMapper(i)):singleMapper(i)}}this.assignMappers.push({key,mapper})}}function URLSearchParams(query){var index,key,value,pairs,i,length,dict=Object.create(null);this[secret]=dict;if(!query)return;if("string"==typeof query){if("?"===query.charAt(0)){query=query.slice(1)}for(pairs=query.split("&"),i=0,length=pairs.length;i<length;i++){value=pairs[i];index=value.indexOf("=");if(-1<index){appendTo(dict,decode(value.slice(0,index)),decode(value.slice(index+1)))}else if(value.length){appendTo(dict,decode(value),"")}}}else{if(isArray(query)){for(i=0,length=query.length;i<length;i++){value=query[i];appendTo(dict,value[0],value[1])}}else if(query.forEach){query.forEach(addEach,dict)}else{for(key in query){appendTo(dict,key,query[key])}}}}var isArray=Array.isArray,URLSearchParamsProto=URLSearchParams.prototype,find=/[!'\(\)~]|%20|%00/g,plus=/\+/g,replace={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"},replacer=function replacer(match){return replace[match]},secret="__URLSearchParams__:"+Math.random();function addEach(value,key){appendTo(this,key,value)}function appendTo(dict,name,value){var res=isArray(value)?value.join(","):value;if(name in dict)dict[name].push(res);else dict[name]=[res]}function decode(str){return decodeURIComponent(str.replace(plus," "))}function encode(str){return encodeURIComponent(str).replace(find,replacer)}URLSearchParamsProto.append=function append(name,value){appendTo(this[secret],name,value)};URLSearchParamsProto.delete=function del(name){delete this[secret][name]};URLSearchParamsProto.get=function get(name){var dict=this[secret];return name in dict?dict[name][0]:null};URLSearchParamsProto.getAll=function getAll(name){var dict=this[secret];return name in dict?dict[name].slice(0):[]};URLSearchParamsProto.has=function has(name){return name in this[secret]};URLSearchParamsProto.set=function set(name,value){this[secret][name]=[""+value]};URLSearchParamsProto.forEach=function forEach(callback,thisArg){var dict=this[secret];Object.getOwnPropertyNames(dict).forEach(function(name){dict[name].forEach(function(value){callback.call(thisArg,value,name,this)},this)},this)};URLSearchParamsProto.toJSON=function toJSON(){return{}};URLSearchParamsProto.toString=function toString(){var dict=this[secret],query=[],i,key,name,value;for(key in dict){name=encode(key);for(i=0,value=dict[key];i<value.length;i++){query.push(name+"="+encode(value[i]))}}return query.join("&")};class Api{constructor(config){this.config=config||{};this.fetchMethod=config.fetch||("undefined"!=typeof fetch?fetch.bind(window):null)}extend(props){var config={};config.base=0===props.base.indexOf("http")?props.base:(this.config.base?this.config.base+"/":"")+props.base;config.data=Object.assign({},this.config.data||{},props.data||{});config.headers=Object.assign({},this.config.headers||{},props.headers||{});return new this.constructor(config)}get(){for(var _len2=arguments.length,args=Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2]}return this.makeRequest("get",...args)}post(){for(var _len3=arguments.length,args=Array(_len3),_key3=0;_key3<_len3;_key3++){args[_key3]=arguments[_key3]}return this.makeRequest("post",...args)}delete(){for(var _len4=arguments.length,args=Array(_len4),_key4=0;_key4<_len4;_key4++){args[_key4]=arguments[_key4]}return this.makeRequest("delete",...args)}makeRequest(method,route,data,options){data=this.mergeData(data||{});options=options||{};var headers=options.headers||{},url=this.getURL(route),req={method:method,headers:Object.assign({Accept:"application/json","Content-Type":"application/json"},Object.assign({},this.config.headers||{},headers))};if("get"===method){var query=new URLSearchParams(data).toString();if(0<query.length)url+="?"+query}else{req.body=JSON.stringify(data)}return this.fetchMethod(url,req).then(res=>{if(options.raw){return res}if(!res.ok){var error=new Error("HTTP ".concat(res.status));error.httpCode=res.status;return res.json().then(data=>{Object.assign(error,data);throw error})}else{return res.json().catch(err=>null)}})}getURL(route){if(this.config.base)route=this.stripDoubleSlashes(this.config.base+"/"+route);return route}stripDoubleSlashes(str){return str.slice(0,8)+str.slice(8).replace(/\/\//g,"/")}mergeData(data){if(!this.config.data)return data;return Object.assign({},data,this.config.data)}}class Rest extends Api{constructor(config,prefetched,dispatch){super(config);this.prefetched=prefetched;this.dispatch=dispatch}extend(){var extended=super.extend(...arguments);extended.prefetched=this.prefetched;extended.dispatch=this.dispatch;return extended}get(){var _arguments=arguments,_superprop_getGet=()=>super.get,_this3=this;return _asyncToGenerator(function*(){var url=0>=_arguments.length?void 0:_arguments[0],pfi=_this3.prefetched.findIndex(p=>p.url===url);if(0<=pfi){return _this3.prefetched.splice(pfi,1)[0].data}return yield _superprop_getGet().call(_this3,..._arguments)})()}makeRequest(){return super.makeRequest(...arguments).then(res=>{this.dispatch();return res}).catch(err=>{this.dispatch();throw err})}}class State{constructor(data){Object.assign(this,data);this.__clientOnlyKeys=[]}has(key){return this.hasOwnProperty(key)}get(key){return this[key]}set(key,value,clientOnly){this[key]=value;if(clientOnly)this.__clientOnlyKeys.push(key)}getOrSet(key){var clientOnly=!1,value;if(2==(1>=arguments.length?0:arguments.length-1)){clientOnly=1>=arguments.length?void 0:arguments[1];value=2>=arguments.length?void 0:arguments[2]}else{value=1>=arguments.length?void 0:arguments[1]}if(this.has(key))return this.get(key);this.set(key,value,clientOnly);return value}delete(key){delete this[key];delete this.__clientOnlyKeys[key]}toString(){var _this4=_objectSpread({},this),{__clientOnlyKeys}=_this4,data=_objectWithoutProperties(_this4,_excluded);__clientOnlyKeys.forEach(key=>delete data[key]);return JSON.stringify(data)}}class Volatile{constructor(){this.data={}}get(key,fill){if(!this.data[key])this.data[key]=fill;return this.data[key]}}var cookies={get:key=>{for(var nameEQ=key+"=",ca=document.cookie.split(";"),i=0,c;i<ca.length;i++){c=ca[i];while(" "==c.charAt(0)){c=c.substring(1,c.length)}if(0==c.indexOf(nameEQ))return c.substring(nameEQ.length,c.length)}return null},set:(key,value,opts)=>{var parts=["".concat(key,"=").concat(value),"path=/"];if(opts.maxAge){parts.push("expires=".concat(new Date(Date.now()+opts.maxAge).toGMTString()))}else if(opts.expires){parts.push("expires=".concat(opts.expires.toGMTString()))}document.cookie=parts.join("; ")}};function I18n$1(){var I18n={},slice=Array.prototype.slice,padding=function padding(number){return("0"+number.toString()).substr(-2)},toFixed=function toFixed(number,precision){return decimalAdjust("round",number,-precision).toFixed(precision)},isObject=function isObject(obj){var type=typeof obj;return"function"==type||"object"===type},isFunction=function isFunction(func){var type=typeof func;return"function"==type},isSet=function isSet(value){return"undefined"!=typeof value&&null!==value},isArray=function isArray(val){if(Array.isArray){return Array.isArray(val)}return"[object Array]"===Object.prototype.toString.call(val)},isString=function isString(val){return"string"==typeof val||"[object String]"===Object.prototype.toString.call(val)},isNumber=function isNumber(val){return"number"==typeof val||"[object Number]"===Object.prototype.toString.call(val)},isBoolean=function isBoolean(val){return!0===val||!1===val},isNull=function isNull(val){return null===val},decimalAdjust=function decimalAdjust(type,value,exp){if("undefined"==typeof exp||0==+exp){return Math[type](value)}value=+value;exp=+exp;if(isNaN(value)||!("number"==typeof exp&&0==exp%1)){return NaN}value=value.toString().split("e");value=Math[type](+(value[0]+"e"+(value[1]?+value[1]-exp:-exp)));value=value.toString().split("e");return+(value[0]+"e"+(value[1]?+value[1]+exp:exp))},lazyEvaluate=function lazyEvaluate(message,scope){if(isFunction(message)){return message(scope)}else{return message}},merge=function merge(dest,obj){var key,value;for(key in obj){if(obj.hasOwnProperty(key)){value=obj[key];if(isString(value)||isNumber(value)||isBoolean(value)||isArray(value)||isNull(value)){dest[key]=value}else{if(null==dest[key])dest[key]={};merge(dest[key],value)}}}return dest},DATE={day_names:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbr_day_names:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],month_names:[null,"January","February","March","April","May","June","July","August","September","October","November","December"],abbr_month_names:[null,"Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],meridian:["AM","PM"]},NUMBER_FORMAT={precision:3,separator:".",delimiter:",",strip_insignificant_zeros:!1},CURRENCY_FORMAT={unit:"$",precision:2,format:"%u%n",sign_first:!0,delimiter:",",separator:"."},PERCENTAGE_FORMAT={unit:"%",precision:3,format:"%n%u",separator:".",delimiter:""},SIZE_UNITS=[null,"kb","mb","gb","tb"],DEFAULT_OPTIONS={defaultLocale:"en",locale:"en",defaultSeparator:".",placeholder:/(?:\{\{|%\{)(.*?)(?:\}\}?)/gm,fallbacks:!1,translations:{},missingBehaviour:"message",missingTranslationPrefix:""};I18n.reset=function(){var key;for(key in DEFAULT_OPTIONS){this[key]=DEFAULT_OPTIONS[key]}};I18n.initializeOptions=function(){var key;for(key in DEFAULT_OPTIONS){if(!isSet(this[key])){this[key]=DEFAULT_OPTIONS[key]}}};I18n.initializeOptions();I18n.locales={};I18n.locales.get=function(locale){var result=this[locale]||this[I18n.locale]||this["default"];if(isFunction(result)){result=result(locale)}if(!1===isArray(result)){result=[result]}return result};I18n.locales["default"]=function(locale){var locales=[],list=[];if(locale){locales.push(locale)}if(!locale&&I18n.locale){locales.push(I18n.locale)}if(I18n.fallbacks&&I18n.defaultLocale){locales.push(I18n.defaultLocale)}locales.forEach(function(locale){var localeParts=locale.split("-"),firstFallback=null,secondFallback=null;if(3===localeParts.length){firstFallback=[localeParts[0],localeParts[1]].join("-");secondFallback=localeParts[0]}else if(2===localeParts.length){firstFallback=localeParts[0]}if(-1===list.indexOf(locale)){list.push(locale)}if(!I18n.fallbacks){return}[firstFallback,secondFallback].forEach(function(nullableFallbackLocale){if("undefined"==typeof nullableFallbackLocale){return}if(null===nullableFallbackLocale){return}if(nullableFallbackLocale===locale){return}if(-1!==list.indexOf(nullableFallbackLocale)){return}list.push(nullableFallbackLocale)})});if(!locales.length){locales.push("en")}return list};I18n.pluralization={};I18n.pluralization.get=function(locale){return this[locale]||this[I18n.locale]||this["default"]};I18n.pluralization["default"]=function(count){switch(count){case 0:return["zero","other"];case 1:return["one"];default:return["other"];}};I18n.currentLocale=function(){return this.locale||this.defaultLocale};I18n.isSet=isSet;I18n.lookup=function(scope,options){options=options||{};var locales=this.locales.get(options.locale).slice(),locale,scopes,fullScope,translations;fullScope=this.getFullScope(scope,options);while(locales.length){locale=locales.shift();scopes=fullScope.split(options.separator||this.defaultSeparator);translations=this.translations[locale];if(!translations){continue}while(scopes.length){translations=translations[scopes.shift()];if(translations===void 0||null===translations){break}}if(translations!==void 0&&null!==translations){return translations}}if(isSet(options.defaultValue)){return lazyEvaluate(options.defaultValue,scope)}};I18n.pluralizationLookupWithoutFallback=function(count,locale,translations){var pluralizer=this.pluralization.get(locale),pluralizerKeys=pluralizer(count),pluralizerKey,message;if(isObject(translations)){while(pluralizerKeys.length){pluralizerKey=pluralizerKeys.shift();if(isSet(translations[pluralizerKey])){message=translations[pluralizerKey];break}}}return message};I18n.pluralizationLookup=function(count,scope,options){options=options||{};var locales=this.locales.get(options.locale).slice(),locale,scopes,translations,message;scope=this.getFullScope(scope,options);while(locales.length){locale=locales.shift();scopes=scope.split(options.separator||this.defaultSeparator);translations=this.translations[locale];if(!translations){continue}while(scopes.length){translations=translations[scopes.shift()];if(!isObject(translations)){break}if(0===scopes.length){message=this.pluralizationLookupWithoutFallback(count,locale,translations)}}if("undefined"!=typeof message&&null!==message){break}}if("undefined"==typeof message||null===message){if(isSet(options.defaultValue)){if(isObject(options.defaultValue)){message=this.pluralizationLookupWithoutFallback(count,options.locale,options.defaultValue)}else{message=options.defaultValue}translations=options.defaultValue}}return{message:message,translations:translations}};I18n.meridian=function(){var time=this.lookup("time"),date=this.lookup("date");if(time&&time.am&&time.pm){return[time.am,time.pm]}else if(date&&date.meridian){return date.meridian}else{return DATE.meridian}};I18n.prepareOptions=function(){var args=slice.call(arguments),options={},subject;while(args.length){subject=args.shift();if("object"!=typeof subject){continue}for(var attr in subject){if(!subject.hasOwnProperty(attr)){continue}if(isSet(options[attr])){continue}options[attr]=subject[attr]}}return options};I18n.createTranslationOptions=function(scope,options){var translationOptions=[{scope:scope}];if(isSet(options.defaults)){translationOptions=translationOptions.concat(options.defaults)}if(isSet(options.defaultValue)){translationOptions.push({message:options.defaultValue})}return translationOptions};I18n.translate=function(scope,options){options=options||{};var translationOptions=this.createTranslationOptions(scope,options),translation,usedScope=scope,optionsWithoutDefault=this.prepareOptions(options);delete optionsWithoutDefault.defaultValue;var translationFound=translationOptions.some(function(translationOption){if(isSet(translationOption.scope)){usedScope=translationOption.scope;translation=this.lookup(usedScope,optionsWithoutDefault)}else if(isSet(translationOption.message)){translation=lazyEvaluate(translationOption.message,scope)}if(translation!==void 0&&null!==translation){return!0}},this);if(!translationFound){return this.missingTranslation(scope,options)}if("string"==typeof translation){translation=this.interpolate(translation,options)}else if(isArray(translation)){translation=translation.map(function(t){return"string"==typeof t?this.interpolate(t,options):t},this)}else if(isObject(translation)&&isSet(options.count)){translation=this.pluralize(options.count,usedScope,options)}return translation};I18n.interpolate=function(message,options){if(null==message){return message}options=options||{};var matches=message.match(this.placeholder),placeholder,value,name,regex;if(!matches){return message}while(matches.length){placeholder=matches.shift();name=placeholder.replace(this.placeholder,"$1");if(isSet(options[name])){value=options[name].toString().replace(/\$/gm,"_#$#_")}else if(name in options){value=this.nullPlaceholder(placeholder,message,options)}else{value=this.missingPlaceholder(placeholder,message,options)}regex=new RegExp(placeholder.replace(/{/gm,"\\{").replace(/}/gm,"\\}"));message=message.replace(regex,value)}return message.replace(/_#\$#_/g,"$")};I18n.pluralize=function(count,scope,options){options=this.prepareOptions({count:count+""},options);var pluralizer,result;result=this.pluralizationLookup(count,scope,options);if("undefined"==typeof result.translations||null==result.translations){return this.missingTranslation(scope,options)}if("undefined"!=typeof result.message&&null!=result.message){return this.interpolate(result.message,options)}else{pluralizer=this.pluralization.get(options.locale);return this.missingTranslation(scope+"."+pluralizer(count)[0],options)}};I18n.missingTranslation=function(scope,options){if("guess"===this.missingBehaviour){var s=scope.split(".").slice(-1)[0];return(0<this.missingTranslationPrefix.length?this.missingTranslationPrefix:"")+s.replace(/_/g," ").replace(/([a-z])([A-Z])/g,function(match,p1,p2){return p1+" "+p2.toLowerCase()})}var localeForTranslation=null!=options&&null!=options.locale?options.locale:this.currentLocale(),fullScope=this.getFullScope(scope,options),fullScopeWithLocale=[localeForTranslation,fullScope].join(options.separator||this.defaultSeparator);return"[missing \""+fullScopeWithLocale+"\" translation]"};I18n.missingPlaceholder=function(placeholder,message,options){return"[missing "+placeholder+" value]"};I18n.nullPlaceholder=function(){return I18n.missingPlaceholder.apply(I18n,arguments)};I18n.toNumber=function(number,options){options=this.prepareOptions(options,this.lookup("number.format"),NUMBER_FORMAT);var negative=0>number,string=toFixed(Math.abs(number),options.precision).toString(),parts=string.split("."),precision,buffer=[],formattedNumber,format=options.format||"%n",sign=negative?"-":"";number=parts[0];precision=parts[1];while(0<number.length){buffer.unshift(number.substr(Math.max(0,number.length-3),3));number=number.substr(0,number.length-3)}formattedNumber=buffer.join(options.delimiter);if(options.strip_insignificant_zeros&&precision){precision=precision.replace(/0+$/,"")}if(0<options.precision&&precision){formattedNumber+=options.separator+precision}if(options.sign_first){format="%s"+format}else{format=format.replace("%n","%s%n")}formattedNumber=format.replace("%u",options.unit).replace("%n",formattedNumber).replace("%s",sign);return formattedNumber};I18n.toCurrency=function(number,options){options=this.prepareOptions(options,this.lookup("number.currency.format",options),this.lookup("number.format",options),CURRENCY_FORMAT);return this.toNumber(number,options)};I18n.localize=function(scope,value,options){options||(options={});switch(scope){case"currency":return this.toCurrency(value,options);case"number":scope=this.lookup("number.format",options);return this.toNumber(value,scope);case"percentage":return this.toPercentage(value,options);default:var localizedValue;if(scope.match(/^(date|time)/)){localizedValue=this.toTime(scope,value,options)}else{localizedValue=value.toString()}return this.interpolate(localizedValue,options);}};I18n.parseDate=function(date){var matches,convertedDate,fraction;if(null==date){return date}if("object"==typeof date){return date}matches=date.toString().match(/(\d{4})-(\d{2})-(\d{2})(?:[ T](\d{2}):(\d{2}):(\d{2})([\.,]\d{1,3})?)?(Z|\+00:?00)?/);if(matches){for(var i=1;6>=i;i++){matches[i]=parseInt(matches[i],10)||0}matches[2]-=1;fraction=matches[7]?1e3*("0"+matches[7]):null;if(matches[8]){convertedDate=new Date(Date.UTC(matches[1],matches[2],matches[3],matches[4],matches[5],matches[6],fraction))}else{convertedDate=new Date(matches[1],matches[2],matches[3],matches[4],matches[5],matches[6],fraction)}}else if("number"==typeof date){convertedDate=new Date;convertedDate.setTime(date)}else if(date.match(/([A-Z][a-z]{2}) ([A-Z][a-z]{2}) (\d+) (\d+:\d+:\d+) ([+-]\d+) (\d+)/)){convertedDate=new Date;convertedDate.setTime(Date.parse([RegExp.$1,RegExp.$2,RegExp.$3,RegExp.$6,RegExp.$4,RegExp.$5].join(" ")))}else if(date.match(/\d+ \d+:\d+:\d+ [+-]\d+ \d+/)){convertedDate=new Date;convertedDate.setTime(Date.parse(date))}else{convertedDate=new Date;convertedDate.setTime(Date.parse(date))}return convertedDate};I18n.strftime=function(date,format,options){var options=this.lookup("date",options),meridianOptions=I18n.meridian();if(!options){options={}}options=this.prepareOptions(options,DATE);if(isNaN(date.getTime())){throw new Error("I18n.strftime() requires a valid date object, but received an invalid date.")}var weekDay=date.getDay(),day=date.getDate(),year=date.getFullYear(),month=date.getMonth()+1,hour=date.getHours(),hour12=hour,meridian=11<hour?1:0,secs=date.getSeconds(),mins=date.getMinutes(),offset=date.getTimezoneOffset(),absOffsetHours=Math.floor(Math.abs(offset/60)),absOffsetMinutes=Math.abs(offset)-60*absOffsetHours,timezoneoffset=(0<offset?"-":"+")+(2>absOffsetHours.toString().length?"0"+absOffsetHours:absOffsetHours)+(2>absOffsetMinutes.toString().length?"0"+absOffsetMinutes:absOffsetMinutes);if(12<hour12){hour12=hour12-12}else if(0===hour12){hour12=12}format=format.replace("%a",options.abbr_day_names[weekDay]);format=format.replace("%A",options.day_names[weekDay]);format=format.replace("%b",options.abbr_month_names[month]);format=format.replace("%B",options.month_names[month]);format=format.replace("%d",padding(day));format=format.replace("%e",day);format=format.replace("%-d",day);format=format.replace("%H",padding(hour));format=format.replace("%-H",hour);format=format.replace("%k",hour);format=format.replace("%I",padding(hour12));format=format.replace("%-I",hour12);format=format.replace("%l",hour12);format=format.replace("%m",padding(month));format=format.replace("%-m",month);format=format.replace("%M",padding(mins));format=format.replace("%-M",mins);format=format.replace("%p",meridianOptions[meridian]);format=format.replace("%P",meridianOptions[meridian].toLowerCase());format=format.replace("%S",padding(secs));format=format.replace("%-S",secs);format=format.replace("%w",weekDay);format=format.replace("%y",padding(year));format=format.replace("%-y",padding(year).replace(/^0+/,""));format=format.replace("%Y",year);format=format.replace("%z",timezoneoffset);format=format.replace("%Z",timezoneoffset);return format};I18n.toTime=function(scope,dateString,options){var date=this.parseDate(dateString),format=this.lookup(scope,options);if(null==date){return date}var date_string=date.toString();if(date_string.match(/invalid/i)){return date_string}if(!format){return date_string}return this.strftime(date,format,options)};I18n.toPercentage=function(number,options){options=this.prepareOptions(options,this.lookup("number.percentage.format",options),this.lookup("number.format",options),PERCENTAGE_FORMAT);return this.toNumber(number,options)};I18n.toHumanSize=function(number,options){var kb=1024,size=number,iterations=0,unit,precision,fullScope;while(size>=1024&&4>iterations){size=size/1024;iterations+=1}if(0==iterations){fullScope=this.getFullScope("number.human.storage_units.units.byte",options);unit=this.t(fullScope,{count:size});precision=0}else{fullScope=this.getFullScope("number.human.storage_units.units."+SIZE_UNITS[iterations],options);unit=this.t(fullScope);precision=0==size-Math.floor(size)?0:1}options=this.prepareOptions(options,{unit:unit,precision:precision,format:"%n%u",delimiter:""});return this.toNumber(size,options)};I18n.getFullScope=function(scope,options){options=options||{};if(isArray(scope)){scope=scope.join(options.separator||this.defaultSeparator)}if(options.scope){scope=[options.scope,scope].join(options.separator||this.defaultSeparator)}return scope};I18n.extend=function(obj1,obj2){if("undefined"==typeof obj1&&"undefined"==typeof obj2){return{}}return merge(obj1,obj2)};I18n.t=I18n.translate.bind(I18n);I18n.l=I18n.localize.bind(I18n);I18n.p=I18n.pluralize.bind(I18n);return I18n}function I18n(){var i18n=new I18n$1,instance=function instance(scope,options){return i18n.translate(scope,options)};instance.spec={};instance.define=(lang,def)=>{if("string"!=typeof lang){def=lang;lang="default"}i18n.locale=lang;i18n.translations[lang]=def;instance.spec[lang]=def;return instance};return instance}class Client{constructor(blueprint){this.ctx={page:{title:void 0,status:200,meta:[],styles:[],scripts:[],goto:(route,opts)=>{c.route.set(route,null,opts)}},state:new State(STATE),volatile:new Volatile,api:new Rest({},STATE.prefetched,c.redraw),i18n:new I18n().define("object"==typeof CORPUS?CORPUS:{}),cookies,redraw:c.redraw};Object.defineProperty(this.ctx.page,"class",{set:function set(cls){document.documentElement.className=cls}});var pages=Object.entries(blueprint.routes).filter(_ref2=>{var[route,thing]=_ref2;return thing.view}).map(_ref3=>{var[route,page]=_ref3;return{route,page}}),models=Object.entries(blueprint.routes).filter(_ref4=>{var[route,thing]=_ref4;return thing.prototype instanceof BaseModel}).map(_ref5=>{var[route,model]=_ref5;return{route,model}}),virtualRoutes=this.buildRoutes(pages),defaultRoute=virtualRoutes.hasOwnProperty("/")?"/":Object.keys(virtualRoutes)[0];this.ctx.i=this.ctx.i18n;this.ctx.models=new ModelRegistry(this.ctx,models);this.ctx.api.dispatch=()=>c.redraw();c.route.prefix="";c.route(document.body,defaultRoute,virtualRoutes);document.documentElement.style.display=""}buildRoutes(def){var _this5=this,routes={},current={page:null,state:null,path:null},delegateComponent={oninit:node=>{},oncreate:node=>{if(current.page.oncreate){Object.assign(node.state,current.state);current.page.oncreate(node);Object.assign(current.state,node.state)}},view:node=>{Object.assign(node.state,current.state);node.ctx=this.ctx;var ret=current.page.view(node),stack=[ret];while(0<stack.length){var v=stack.pop();if(v&&"object"==typeof v)v.ctx=this.ctx;if(v&&v.children)stack.push(...v.children)}Object.assign(current.state,node.state);return ret}},_loop3=function _loop3(page,_route4){routes[_route4]={onmatch:(args,path,route)=>{if(_this5.deriveDiffPath(path)!==_this5.deriveDiffPath(current.path)){current.page=page;current.state={};if(page.oninit){var ret=current.page.oninit({attrs:args,state:current.state,ctx:_this5.ctx});if(ret instanceof Promise)ret.then(_this5.ctx.redraw)}window.scrollTo(0,0)}current.path=path;return delegateComponent},render:node=>node}};for(var{route:_route4,page}of def){_loop3(page,_route4)}return routes}deriveDiffPath(path){if(!path)return null;return path.split(/\?|\#/g)[0]}}var ocLink=c.route.Link;window.scrollSnapshots={};c.route.Link={view:node=>{Object.assign({},node.attrs,{onclick:e=>{var scrollSnapshot={window:window.scrollY,containers:{}};Array.from(document.querySelectorAll("*")).forEach(el=>{if(el.dataset.scrollId){scrollSnapshot.containers[el.dataset.scrollId]=el.scrollTop}});window.scrollSnapshots[m.route.get()]=scrollSnapshot;if(node.attrs.onclick){node.attrs.onclick(e)}}});return ocLink.view(node)}};var Index={oninit:node=>{node.ctx.page.title="Welcome"},view:node=>c("section",null,c("h1",null,"An open standard for asset metadata on the XRP Ledger."),c("p",null,"This site is under construction."))},blueprint={routes:{"/":Index}};new Client(blueprint)})();
